---
applyTo: 'modules/home/nixvim/**/*lazyvim*.nix'
---

# LazyVim + NixVim Configuration Guide

## Architecture Overview

This setup uses a **hybrid approach** combining NixVim (declarative) with LazyVim (dynamic). This is important as the user wants to have a flexbile Neovim setup where they can easily add/remove plugins without needing to rebuild their entire NixOS configuration.

- **NixVim** manages the base Neovim configuration at `~/.config/nvim/` (read-only, generated from Nix)
- **LazyVim** provides the plugin ecosystem and sensible defaults
- **`~/.config/nvim-local/`** provides a writable directory for dynamic plugin management

### Why `nvim-local` instead of standard `~/.config/nvim/lua/plugins/`?

According to [LazyVim docs](https://www.lazyvim.org/configuration), user plugins should go in `~/.config/nvim/lua/plugins/`. However, we can't use this because:

`~/.config/nvim/` is **read-only** and generated by NixOS on every rebuild. Any manual changes to `~/.config/nvim/lua/plugins/` would be **wiped out** on rebuild.

## Directory Structure

```
~/.config/nvim/              # NixVim-generated (read-only)
└── init.lua                 # Generated from lazyvim.nix

~/.config/nvim-local/        # Writable runtime config
└── lua/
    └── user/
        └── specs/
            ├── init.lua       # Aggregates all spec files
            └── keymaps.lua    # Your custom keymaps and plugin specs
```

## Issues

- currently neovim brings an error on startup: `module 'user.specs' not found`. LLM tried to fix it with an init.lua file that aggregates all spec files in this folder. So far no success.

## Testing

Verify specs are loading:
```bash
nvim --headless +"lua vim.opt.rtp:prepend(vim.fn.expand('~/.config/nvim-local')); local specs = require('user.specs'); print('Total specs:', #specs)" +qall
```
