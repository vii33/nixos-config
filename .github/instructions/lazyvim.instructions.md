---
applyTo: 'modules/home/nixvim/**/*.nix'
---

# LazyVim + NixVim Configuration Guide

The user wants to use Neovim with LazyVim as the plugin manager. To leverage the declarative nature of NixOS, we use NixVim to generate the base Neovim configuration, while allowing dynamic plugin management via LazyVim (hybrid approach).
This allows the user to add/remove plugins and settings without needing to rebuild their entire NixOS configuration.

## Architecture Overview

- **NixVim** manages the base Neovim configuration at `~/.config/nvim/` (read-only, generated from Nix)
- **LazyVim** provides the plugin ecosystem and sensible defaults
- **`modules/home/nixvim/lua-specs/`** contains the Lua configuration files (plugins, keymaps, etc.) which are injected into the Neovim runtime path.

- `lazyvim.nix` is used in NixOs configuration

The official LazyVim docs can be found [here](https://www.lazyvim.org/). 
The official LazyVim starter configuration can be found [here](https://github.com/LazyVim/starter).


### Configuration Strategy

We cannot use the standard `~/.config/nvim/lua/plugins/` directory because `~/.config/nvim/` is **read-only** and generated by NixOS.

Instead, we store Lua configuration files in `modules/home/nixvim/lua-specs/` within the repository. `lazyvim.nix` adds this directory to Neovim's `package.path`, allowing us to `require` these files directly.

## Host Differences

- **laptop**: LazyVim specs are managed by Home Manager via `lazyvim.nix` (read-only symlinks from Nix store). Edit files in this repo and rebuild.
- **work (macOS)**: NixVim/lazyvim.nix is **not enabled**. Lua specs live directly in `~/.config/nvim/lua/plugins/` as writable files. Changes should be occasionally backed up to `modules/home/nixvim/lua-specs/` in this repo.

## Directory Structure

```
nixos-config/
└── modules/
    └── home/
        └── nixvim/
            ├── lazyvim.nix    # Main NixVim configuration
            └── lua-specs/     # Lua configuration files
                ├── init.lua   # Aggregates all spec files
                ├── keymaps.lua
                └── ...
```

## LSP Management: Mason vs Nix

**Current Approach: Nix-managed LSPs (Recommended)**

This configuration uses **Nix to manage all LSP servers** declaratively via `programs.nixvim.lsp.servers` in `lazyvim.nix`. Mason is installed but disabled from auto-installing LSPs via `mason-local.lua`.

**Why Nix over Mason?**
- **No dynamic linking issues**: Mason-built binaries expect FHS paths (`/lib`, `/usr/lib`) which don't exist on NixOS
- **Reproducibility**: Flake lock pins exact LSP versions
- **Simplicity**: No need for `nix-ld` or FHS wrappers
- **Reliability**: All dependencies managed declaratively

**Using Mason on NixOS (Not Recommended)**

While technically possible with workarounds, it introduces complexity:
- Requires `programs.nix-ld.enable = true` for dynamic linking
- Need Rust toolchain (`cargo`, `rustc`) and build tools in PATH
- Runtime library path issues common
- Defeats NixOS declarative philosophy

**Best Practice**: Manage core LSPs via Nix, keep Mason available for manual experimentation only.

# Important to remember
- The current mason repo name is `mason-org/mason.nvim` instead of `williamboman/mason.nvim`.