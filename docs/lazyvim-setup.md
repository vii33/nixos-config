# LazyVim with Nixvim Setup

## What Changed

Your `lazyvim.nix` configuration has been updated to properly integrate LazyVim with nixvim:

1. **LazyVim managed at runtime**: Instead of using the outdated LazyVim package from nixpkgs, Lazy.nvim now downloads and manages the latest LazyVim version at runtime. This ensures you always have the most up-to-date version with all features working correctly.

2. **Auto-create user specs directory**: The configuration automatically creates `~/.config/nvim-local/lua/user/specs/` for your custom plugin configurations

3. **Safe user specs import**: Checks if the user specs directory exists and contains `.lua` files before attempting to import, preventing errors when the directory is empty or doesn't exist yet

## How It Works

- **Only lazy.nvim from Nix**: Only the lazy.nvim plugin manager itself is installed via Nix (declarative, reproducible)
- **LazyVim and plugins at runtime**: LazyVim and all other plugins are downloaded and managed by Lazy at runtime in `~/.local/share/nvim/lazy/`
- **Always up-to-date**: You get the latest LazyVim version with all features and bug fixes
- **Quick iterations**: Add/modify plugins in `~/.config/nvim-local/lua/user/specs/` without rebuilding NixOS

## Quick Iteration Workflow

1. **Apply the changes** (you'll need to rebuild your system):
   ```fish
   sudo nixos-rebuild switch --flake .#laptop
   ```

2. **Start neovim** - LazyVim should now load without errors
   - On first launch, Lazy will download LazyVim and all plugins (this may take a minute)
   - You'll see a progress window showing the downloads
   - Once complete, LazyVim will be ready to use

3. **Add custom plugins** by creating files in `~/.config/nvim-local/lua/user/specs/`:
   ```fish
   # Example: add a custom plugin
   mkdir -p ~/.config/nvim-local/lua/user/specs
   nvim ~/.config/nvim-local/lua/user/specs/custom.lua
   ```

4. **Example custom plugin spec** (`~/.config/nvim-local/lua/user/specs/custom.lua`):
   ```lua
   return {
     -- Example: add a colorscheme
     {
       "folke/tokyonight.nvim",
       lazy = false,
       priority = 1000,
       opts = {},
     },
     
     -- Example: add a plugin with custom config
     {
       "folke/which-key.nvim",
       opts = {
         delay = 200,
       },
     },
   }
   ```

5. **Reload changes** in nvim:
   - Press `<leader>l` (space + l) to open Lazy UI
   - Or run `:Lazy sync` to install/update plugins
   - Or restart nvim

## LazyVim Extras

You can enable LazyVim extras by uncommenting them in `lazyvim.nix` or adding them to your user specs:

```lua
-- In lazyvim.nix (requires rebuild):
{ import = "lazyvim.plugins.extras.lang.rust" },

-- Or in ~/.config/nvim-local/lua/user/specs/extras.lua (no rebuild):
return {
  { import = "lazyvim.plugins.extras.lang.rust" },
  { import = "lazyvim.plugins.extras.ui.mini-starter" },
}
```

## Directory Structure

```
~/.config/
├── nvim/              # Generated by nixvim (read-only)
└── nvim-local/        # Your writable customizations
    └── lua/
        └── user/
            └── specs/ # Your custom plugin specs
                ├── custom.lua
                ├── overrides.lua
                └── extras.lua
```

## Troubleshooting

If you still see "No specs found" errors:
1. Make sure you've rebuilt with the updated configuration
2. On first launch, wait for Lazy to download all plugins
3. Check `:Lazy` to see if LazyVim is being downloaded
4. If stuck, try `:Lazy sync` to force a sync

If you see "module 'lazyvim.util.format' not found":
- This was caused by using the outdated LazyVim package from nixpkgs
- The fix: Let Lazy.nvim manage LazyVim at runtime (current configuration)
- After rebuilding, LazyVim will download the latest version with all modules

## Resources

- [LazyVim documentation](https://www.lazyvim.org/)
- [Lazy.nvim plugin manager](https://github.com/folke/lazy.nvim)
- [LazyVim extras](https://www.lazyvim.org/extras)
